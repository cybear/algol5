{
  "meta": {
    "id": "threemusketeers",
    "name": "Three Musketeers",
    "source": "http://www.di.fc.ul.pt/~jpn/gv/3musketeers.htm",
    "tagline": "Will the three musketeers escape the soldiers out to get them?",
    "tags": ["asymmetric","formation"],
    "instructions": {
      "startTurn": ["playercase",
        ["line","Select which","king","to move"],
        ["line","Select which","pawn","to move"]
      ],
      "selectunit": ["playercase",
        ["line","Select a","pawn","adjacent to the","selectunit","king","to attack"],
        ["line","Select an empty space adjacent to the","selectunit","pawn","to move to"]
      ],
      "selectmovetarget": ["playercase",
        ["line","Press","move","to make your","selectunit","king","attack the","selectmovetarget","pawn"],
        ["line","Press","move","to go from","selectunit","to","selectmovetarget"]
      ]
    }
  },
  "graphics": { "icons": {"pawns":"pawn","kings":"king"}},
  "board": { "height": 5, "width": 5 },
  "setup": {
    "kings": {"1":["a1","c3","e5"]},
    "pawns": {"2":[["holerect","a1","e5",["a1","c3","e5"]]]}
  },
  "startTurn": {
    "link": "selectunit"
  },
  "endGame": {
    "musketeersinline": {"condition":["notempty","musketeerline"],"who":2,"show":"kings"},
    "strandedmusketeers": {"condition":["same",["sizeof","strandedmusketeers"],3],"who":1}
  },
  "marks": {
    "selectunit": {
      "from": "myunits",
      "runGenerator": "findmovetargets",
      "link": "selectmovetarget"
    },
    "selectmovetarget": {
      "from": "movetargets",
      "link": "move"
    }
  },
  "commands": {
    "move": {
      "applyEffect": ["stompat","selectunit","selectmovetarget"],
      "runGenerators": ["findmusketeerline",["ifplayer",2,"findstrandedmusketeers"]],
      "link": "endturn"
    }
  },
  "generators": {
    "findstrandedmusketeers": {
      "type": "neighbour",
      "dirs": [1,3,5,7],
      "starts": "kings",
      "ifover": "pawns",
      "draw": {
        "start": {
          "condition": ["falsy",["neighbourcount"]],
          "tolayer":"strandedmusketeers"
        }
      }
    },
    "findmusketeerline": {
      "type": "walker",
      "dirs": [1,3,5,7],
      "starts": "kings",
      "count": "kings",
      "draw": {
        "start": {
          "condition": ["same",2,["totalcount"]],
          "tolayer": "musketeerline"
        }
      }
    },
    "findmovetargets": {
      "type": "neighbour",
      "dirs": [1,3,5,7],
      "start": "selectunit",
      "condition": ["playercase",
        ["anyat","oppunits",["target"]],
        ["noneat","units",["target"]]
      ],
      "draw": {
        "neighbours": {
          "tolayer": "movetargets"
        }
      }
    }
  }
}