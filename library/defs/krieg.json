{
  "meta": {
    "id": "krieg",
    "name": "Krieg",
    "source": "http://www.di.fc.ul.pt/~jpn/gv/krieg.htm",
    "tags": ["infiltrate","multiplegoals"],
    "instructions": {
      "startTurn": ["ifelse",
        ["morethan",["turn"],2],
        ["line","Select a unit to move that your didn't move last turn"],
        ["line","Select a unit to move"]
      ],
      "selectunit": "Select an empty square to move to",
      "selectmove": ["line","Press","move","to go from","selectunit",["ifelse",
        ["and",["anyat","oppbases","selectmove"],["noneat","oppbases","selectunit"]],
        ["line","into the opponent base at","selectmove"],
        ["line","to","selectmove"]
      ]]
    }
  },
  "graphics": {
    "tiles": { "corners": "playercolour", "bases": "castle" },
    "icons": { "notfrozens": "knights", "frozens": "rooks" }
  },
  "board": {
    "width": 4, "height": 4,
    "terrain": {
      "southeast": ["a4","c2"],
      "northwest": ["b3","d1"],
      "corners": {"1":["a4"],"2":["d1"]},
      "bases": {"1":["b4","a3","b3"],"2":["c2","d2","c1"]}
    }
  },
  "setup": {
    "notfrozens": {"1":["a4","b4","a3","b3"],"2":["c2","c1","d2","d1"]}
  },
  "marks": {
    "selectunit": {
      "from": "mynotfrozens",
      "runGenerator": "findmovetargets",
      "link": "selectmove"
    },
    "selectmove": {
      "from": "movetargets",
      "link": "move"
    }
  },
  "startTurn": {
    "link": "selectunit"
  },
  "endGame": {
    "cornerinfiltration": {"condition": ["overlaps","oppcorners","myunits"]},
    "occupation": {"condition": ["same",["sizeof",["intersect","oppbases","myunits"]],2]}
  },
  "commands": {
    "move": {
      "applyEffects": [
        ["foridin","myfrozens",
          ["setid",["loopid"],"group","notfrozens"]
        ],
        ["setat","selectunit","group","frozens"],
        ["moveat","selectunit","selectmove"]
      ],
      "link": "endturn"
    }
  },
  "generators": {
    "findmovetargets": {
      "type": "neighbour",
      "start": "selectunit",
      "unlessover": "units",
      "dirs": ["ifelse",
        ["anyat","southeast",["start"]],
        [1,3,4,5,7],
        ["ifelse",
          ["anyat","northwest",["start"]],
          [1,3,5,7,8],
          [1,3,5,7]
        ]
      ],
      "draw": {
        "neighbours": {
          "tolayer": "movetargets"
        }
      }
    }
  },
  "AI": {
    "generators": {
      "findmythreats": {
        "type": "neighbour",
        "starts": "myunits",
        "dirs": ["playercase",
          ["ifelse",["anyat","oppbases",["start"]],[4],[3,5]],
          ["ifelse",["anyat","oppbases",["start"]],[8],[7,1]]
        ],
        "ifover": ["union","oppbases","oppcorners"],
        "draw": {
          "neighbours": {
            "tolayer": ["ifelse",
              ["anyat","myfrozens",["start"]],
              ["ifelse",["anyat","units",["target"]],"myfrozenguardedthreat","myfrozenfreethreat"],
              ["ifelse",["anyat","units",["target"]],"mymoverguardedthreat","mymoverfreethreat"]
            ]
          }
        }
      },
      "findoppthreats": {
        "type": "neighbour",
        "starts": "oppunits",
        "dirs": ["playercase",
          ["ifelse",["anyat","mybases",["start"]],[8],[7,1]],
          ["ifelse",["anyat","mybases",["start"]],[4],[3,5]]
        ],
        "ifover": ["union","mybases","mycorners"],
        "draw": {
          "neighbours": {
            "tolayer": ["ifelse",
              ["anyat","oppfrozens",["start"]],
              ["ifelse",["anyat","units",["target"]],"oppfrozenguardedthreat","oppfrozenfreethreat"],
              ["ifelse",["anyat","units",["target"]],"oppmoverguardedthreat","oppmoverfreethreat"]
            ]
          }
        }
      }
    },
    "aspects": {
      "myfrozenguardedthreat": ["sizeof","myfrozenguardedthreat"],
      "myfrozenfreethreat": ["sizeof","myfrozenfreethreat"],
      "mymoverguardedthreat": ["sizeof","mymoverguardedthreat"],
      "mymoverfreethreat": ["sizeof","mymoverfreethreat"],
      "myfrozeninfiltrators": ["sizeof",["intersect","myfrozens","oppbases"]],
      "myfreeinfiltrators": ["sizeof",["intersect","mynotfrozens","oppbases"]],
      "oppfrozenguardedthreat": ["sizeof","oppfrozenguardedthreat"],
      "oppfrozenfreethreat": ["sizeof","oppfrozenfreethreat"],
      "oppmoverguardedthreat": ["sizeof","oppmoverguardedthreat"],
      "oppmoverfreethreat": ["sizeof","oppmoverfreethreat"],
      "oppfrozeninfiltrators": ["sizeof",["intersect","oppfrozens","mybases"]],
      "oppfreeinfiltrators": ["sizeof",["intersect","oppnotfrozens","mybases"]]
    },
    "brains": {
      "Fred": {
        "generators": ["findmythreats","findoppthreats"],
        "plus": {
          "myfrozenguardedthreat": 1,
          "myfrozenfreethreat": 2,
          "mymoverguardedthreat": 3,
          "mymoverfreethreat": 4,
          "myfrozeninfiltrators": 5,
          "myfreeinfiltrators": 6
        },
        "minus": {
          "oppfrozenguardedthreat": 1,
          "oppfrozenfreethreat": 2,
          "oppmoverguardedthreat": 3,
          "oppmoverfreethreat": 4,
          "oppfrozeninfiltrators": 5,
          "oppfreeinfiltrators": 6
        }
      }
    }
  }
}