{
  "meta": {
    "id": "daggers",
    "name": "Daggers",
    "about": {
      "tags": ["differentunits","asymmetric","multiplegoals","infiltrate","killking","capture"],
      "tagline": "Will the superior position at the top of the hill beat overwhelming numbers?",
      "links": {
        "World of Abstract Games": "http://www.di.fc.ul.pt/~jpn/gv/daggers.htm",
        "Board game geek": "https://boardgamegeek.com/boardgame/186029/daggers"
      }
    },
    "rules": {
      "flow": "Players take turn moving a single unit",
      "goals": {
        "regicide": {
          "who": [1,2],
          "rule": ["line","Kill an enemy","king"]
        },
        "infiltration": {
          "who": [1,2],
          "rule": ["line","Move a","king","to the enemy",["tile","base"]]
        }
      },
      "units": {
        "bishop": {
          "who": [1,2],
          "rule": ["line","Moves vertical or diagonal, 1 step uphill or any number of steps downhill. Captures",["unitname","kings"],"vertically, or any piece diagonally."]
        },
        "king": {
          "who": [1,2],
          "rule": "Moves 1 step in any direction, capturing any enemy."
        }
      }
    },
    "instructions": {
      "startTurn": ["line","Select a","bishop","or","king","to move"],
      "selectunit": ["line","Select where to move the","selectunit",["unitnameat","selectunit"]],
      "selectmovetarget": ["line",
        "Press","move","to go",
        ["ifelse",
          ["higher","selectmovetarget","selectunit"],
          "uphill",
          ["if",
            ["higher","selectunit","selectmovetarget"],
            "downhill"
          ]
        ],
        "from","selectunit",
        ["ifelse",
          ["anyat","units","selectmovetarget"],
          ["line","and kill the enemy",["unitnameat","selectmovetarget"],"at","selectmovetarget"],
          ["line","to","selectmovetarget"]
        ]
      ]
    }
  },
  "board": {
    "height": 8,
    "width": 8,
    "terrain": {
      "bases": {"1":[["rect","a8","h8"]],"2":[["rect","a1","h1"]]}
    }
  },
  "graphics": {
    "tiles": { "bases": "playercolour" },
    "icons": { "daggers": "bishop", "crowns": "king" }
  },
  "setup": {
    "crowns": {"1":["d8","e8"],"2":["c1","f1"]},
    "daggers": {"1":[["rect","c7","f7"]],"2":["c3","f3",["rect","b2","g2"]]}
  },
  "endGame": {
    "infiltration":{ "condition": ["overlaps","mycrowns","oppbases"], "show": ["intersect","mycrowns","oppbases"]},
    "regicide": { "condition": ["same",["sizeof","oppcrowns"],1] }
  },
  "startTurn": {
    "link": "selectunit"
  },
  "marks": {
    "selectunit": {
      "from": "myunits",
      "runGenerator": ["ifelse",["anyat","mycrowns","selectunit"],"findcrowntargets","finddaggertargets"],
      "link": "selectmovetarget"
    },
    "selectmovetarget": {
      "from": "movetarget",
      "link": "move"
    }
  },
  "commands": {
    "move": {
      "applyEffects": [
        ["stompat","selectunit","selectmovetarget"]
      ],
      "link": "endturn"
    }
  },
  "generators": {
    "findcrowntargets": {
      "type": "neighbour",
      "dirs": [1,2,3,4,5,6,7,8],
      "start": "selectunit",
      "draw": {
        "neighbours": {
          "condition": ["noneat","myunits",["target"]],
          "tolayer": "movetarget"
        }
      }
    },
    "finddaggertargets": {
      "type": "walker",
      "start": "selectunit",
      "dirs": [8,1,2,4,5,6],
      "blocks": "units",
      "max": ["ifelse",["valinlist",["dir"],[8,1,2]],1,8],
      "draw": {
        "steps": {
          "tolayer": "movetarget"
        },
        "block": {
          "condition": ["and",
            ["noneat","myunits",["target"]],
            ["not",["and",
              ["valinlist",["dir"],[1,5]],
              ["anyat","oppdaggers",["target"]]
            ]]
          ],
          "tolayer": "movetarget"
        }
      }
    }
  }
}