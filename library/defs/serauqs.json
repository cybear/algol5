{
  "meta": {
    "id": "serauqs",
    "TODO": "maybe can move lines? ALSO, winline showing!",
    "name": "Serauqs",
    "source": "https://boardgamegeek.com/image/274401/serauqs",
    "tags": ["formation"],
    "instructions": {
      "startTurn": ["ifelse",
        ["morethan",["turn"],2],
        "Select which unit to move",
        "Select which unit to make wild"
      ],
      "selectunit": ["ifelse",
        ["morethan",["turn"],2],
        "Select where to move this unit",
        ["line","Press","makewild","to make this unit match for your opponent too"]
      ],
      "selectmovetarget": ["line",
        "Press","move","to move from","selectunit","to","selectmovetarget"
      ]
    }
  },
  "graphics": {
    "icons": {"soldiers":"pawn","wild":"king"},
    "tiles": {"corners":"grass","middle":"castle"}
  },
  "board": {
    "height":4,
    "width":4,
    "terrain": {
      "base": {"1":[["rect","a1","d1"]],"2":[["rect","a4","d4"]]},
      "corners": ["a1","a4","d1","d4"],
      "middle": [["rect","b2","c3"]]
    }
  },
  "setup": { "soldiers": {"1":[["rect","a1","d1"]],"2":[["rect","a4","d4"]]} },
  "endGame": {
    "madeline": {
      "condition":["notempty","winline"],
      "show":"winline"
    },
    "madex": {
      "condition":["morethan",["sizeof",["intersect","corners",["union","myunits","oppwild"]]],3],
      "show": "corners"
    },
    "tookcenter": {
      "condition":["morethan",["sizeof",["intersect","middle",["union","myunits","oppwild"]]],3],
      "show": "middle"
    }
  },
  "startTurn": {
    "link": "selectunit"
  },
  "marks": {
    "selectunit": {
      "from": "myunits",
      "runGenerator": "findmovetargets",
      "link": ["ifelse",["morethan",3,["turn"]],"makewild","selectmovetarget"]
    },
    "selectmovetarget": {
      "from": "movetargets",
      "link": "move"
    }
  },
  "commands": {
    "makewild": {
      "applyEffect": ["setat","selectunit","group","wild"],
      "link": "endturn"
    },
    "move": {
      "applyEffect": ["moveat","selectunit","selectmovetarget"],
      "runGenerator": "findwinline",
      "link": "endturn"
    }
  },
  "generators": {
    "findmovetargets": {
      "type": "neighbour",
      "start": "selectunit",
      "dirs": [1,2,3,4,5,6,7,8],
      "unlessover": "units",
      "draw": {
        "neighbours": {
          "tolayer": "movetargets"
        }
      }
    },
    "findwinline": {
      "type": "walker",
      "starts": ["union","myunits","oppwild"],
      "dirs": [1,2,3,4,5,6,7,8],
      "steps": ["union","myunits","oppwild"],
      "count": "mybase",
      "startasstep": true,
      "draw": {
        "steps": {
          "condition": ["and",
            ["same",["walklength"],4],
            ["different",["totalcount"],4]
          ],
          "tolayer": "winline"
        }
      }
    }
  }
}