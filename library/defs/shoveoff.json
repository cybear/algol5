{
  "TODO": "findaffected SHOULD BE AN OFFSET",
  "meta": {
    "id": "shoveoff",
    "name": "Shove off",
    "source": "https://boardgamegeek.com/boardgame/20522/shove",
    "tags": [],
    "instructions": {
      "startTurn": ["line",
        "Select where to shove in",
        ["ifelse",
          ["same",["sizeof","myunits"],7],
          "your last off-board unit",
          ["ifelse",
            ["same",["sizeof","myunits"],8],
            "a neutral unit",
            ["line","one of your",["minus",8,["sizeof","myunits"]],"remaining off-board units"]
          ]
        ]
      ],
      "selectpushpoint": ["line",
        "Press",
        ["orlist",
          [["notempty","spawnsouth"],"south"],
          [["notempty","spawnnorth"],"north"],
          [["notempty","spawnwest"],"west"],
          [["notempty","spawneast"],"east"]
        ],
        "to shove in that direction and make room for the new unit at","selectpushpoint"
      ]
    }
  },
  "graphics": {
    "icons": {"soldiers":"pawn"}
  },
  "board": {
    "height":4,
    "width":4,
    "terrain": {
      "southedge": [["rect","a1","d1"]],
      "northedge": [["rect","a4","d4"]],
      "westedge": [["rect","a1","a4"]],
      "eastedge": [["rect","d1","d4"]],
      "edge": [["holerect","a1","d4",["b2","b3","c2","c3"]]]
    }
  },
  "setup": {
    "soldiers": {"0":[["rect","a1","d4"]]}
  },
  "endGame": {
    "madeline": {"condition":["notempty","fourinarow"],"show":"fourinarow"}
  },
  "startTurn": {
    "link": "selectpushpoint"
  },
  "marks": {
    "selectpushpoint": {
      "from": "edge",
      "runGenerators": ["findaffected","findresults"],
      "links": [
        ["if",["notempty","spawnsouth"],"south"],
        ["if",["notempty","spawnnorth"],"north"],
        ["if",["notempty","spawnwest"],"west"],
        ["if",["notempty","spawneast"],"east"]
      ]
    }
  },
  "commands": {
    "north": {
      "applyEffects": [
        ["killat",["onlyin","squishnorth"]],
        ["pushin","pushnorth",1,1],
        ["spawn",["onlyin","spawnnorth"],"soldiers",["ifelse",["morethan",8,["sizeof","myunits"]],["player"],0]]
      ],
      "runGenerator": "findfourinarow",
      "link": "endturn"
    },
    "south": {
      "applyEffects": [
        ["killat",["onlyin","squishsouth"]],
        ["pushin","pushsouth",5,1],
        ["spawn",["onlyin","spawnsouth"],"soldiers",["ifelse",["morethan",8,["sizeof","myunits"]],["player"],0]]
      ],
      "runGenerator": "findfourinarow",
      "link": "endturn"
    },
    "east": {
      "applyEffects": [
        ["killat",["onlyin","squisheast"]],
        ["pushin","pusheast",3,1],
        ["spawn",["onlyin","spawneast"],"soldiers",["ifelse",["morethan",8,["sizeof","myunits"]],["player"],0]]
      ],
      "runGenerator": "findfourinarow",
      "link": "endturn"
    },
    "west": {
      "applyEffects": [
        ["killat",["onlyin","squishwest"]],
        ["pushin","pushwest",7,1],
        ["spawn",["onlyin","spawnwest"],"soldiers",["ifelse",["morethan",8,["sizeof","myunits"]],["player"],0]]
      ],
      "runGenerator": "findfourinarow",
      "link": "endturn"
    }
  },
  "generators": {
    "findaffected": {
      "type": "walker",
      "start": "selectpushpoint",
      "dirs": [1,3,5,7],
      "draw": {
        "last": {
          "condition": ["same",["walklength"],3],
          "unlessover": "oppunits",
          "tolayer": "targetedgepoints",
          "include": {
            "dir": ["reldir",["dir"],5]
          }
        }
      }
    },
    "findresults": {
      "type": "walker",
      "starts": "targetedgepoints",
      "dir": ["read","targetedgepoints",["start"],"dir"],
      "startasstep": true,
      "draw": {
        "start": {
          "tolayer": ["ifelse",
            ["same",["dir"],1],
            "squishsouth",
            ["ifelse",
              ["same",["dir"],3],
              "squishwest",
              ["ifelse",
                ["same",["dir"],5],
                "squishnorth",
                "squisheast"
              ]
            ]
          ]
        },
        "steps": {
          "condition": ["different",["step"],1],
          "tolayer": ["ifelse",
            ["same",["dir"],1],
            "pushsouth",
            ["ifelse",
              ["same",["dir"],3],
              "pushwest",
              ["ifelse",
                ["same",["dir"],5],
                "pushnorth",
                "pusheast"
              ]
            ]
          ]
        },
        "last": {
          "tolayer": ["ifelse",
            ["same",["dir"],1],
            "spawnsouth",
            ["ifelse",
              ["same",["dir"],3],
              "spawnwest",
              ["ifelse",
                ["same",["dir"],5],
                "spawnnorth",
                "spawneast"
              ]
            ]
          ]
        }
      }
    },
    "findfourinarow": {
      "type": "walker",
      "starts": "myunits",
      "steps": "myunits",
      "startasstep": true,
      "draw": {
        "steps": {
          "condition": ["same",["walklength"],4],
          "tolayer": "fourinarow"
        }
      }
    }
  }
}