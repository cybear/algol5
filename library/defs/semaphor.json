{
  "meta": {
    "id": "semaphor",
    "name": "Semaphor",
    "source": "http://www.di.fc.ul.pt/~jpn/gv/semaphor.htm",
    "tags": ["commonunits","formation","deploy","chooseaction","changeunit"],
    "instructions": {
      "startTurn": ["line",
        "Select", ["orlist",
          [["different",["sizeof","units"],12],"an empty square to deploy to"],
          [["notempty",["union","bishops","pawns"]],["line","a",["orlist",
            [["notempty","pawns"],"pawn"],
            [["notempty","bishops"],"bishop"]
          ],"to promote"]]
        ]
      ],
      "selectdeploytarget": ["line","Press","deploy","to place a pawn at","selectdeploytarget"],
      "selectunit": ["line","Press","promote","to turn the",["ifelse",
        ["anyat","pawns","selectunit"],
        "pawn into a bishop",
        "bishop into a king"
      ]]
    }
  },
  "graphics": {"icons":{"kings":"king","pawns":"pawn","bishops":"bishop"}},
  "board": {"width":4,"height":3},
  "startTurn": {
    "links": ["selectdeploytarget","selectunit"]
  },
  "endGame": {
    "madeline": {"condition":["notempty","line"],"show":"line"}
  },
  "marks": {
    "selectdeploytarget": {
      "from": ["subtract","board","units"],
      "link": "deploy"
    },
    "selectunit": {
      "from": ["union","pawns","bishops"],
      "link": "promote"
    }
  },
  "commands": {
    "deploy": {
      "applyEffect": ["spawn","selectdeploytarget","pawns",0],
      "runGenerator": "findlines",
      "link": "endturn"
    },
    "promote": {
      "applyEffect": ["setat","selectunit","group",["ifelse",["anyat","pawns","selectunit"],"bishops","kings"]],
      "runGenerator": "findlines",
      "link": "endturn"
    }
  },
  "generators": {
    "findlines": {
      "type": "walker",
      "dirs": [1,2,3,4],
      "starts": "units",
      "steps": ["unitlayer",["read","units",["start"],"group"]],
      "startasstep": true,
      "draw": {
        "steps": {
          "condition": ["morethan",["walklength"],2],
          "tolayer": "line"
        }
      }
    }
  }
}