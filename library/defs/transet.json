{
  "meta": {
    "id": "transet",
    "name": "Transet",
    "source": "http://sagme.blogspot.se/2013/05/transet.html",
    "tags": ["infiltration","differentunits"],
    "instructions": {
      "startTurn": "Select a unit to move",
      "selectunit": ["line",
        "Select",["orlist",
          [["notempty","movetargets"],["line","a square to move the","selectunit",["unitnameat","selectunit"],"to"]],
          [["markavailable","selectswapunit"],["line","another unit to swap the","selectunit",["unitnameat","selectunit"],"with"]]
        ]
      ],
      "selectmovetarget": ["ifelse",
        ["and",
          ["anyat","units","selectmovetarget"],
          ["noneat","oppbase","selectmovetarget"]
        ],
        ["line","Select where the enemy at","selectmovetarget","should end up"],
        ["line","Press","move","to go from","selectunit","to","selectmovetarget"]
      ],
      "selectdeportdestination": ["line",
        "Press","move","to go from","selectunit","to","selectmovetarget","and deport the enemy to","selectdeportdestination"
      ],
      "selectswapunit": ["line",
        "Select a neighbouring square for","selectunit","to step to. The","selectswapunit","unit will step in the opposite direction"
      ],
      "selectswap1target": ["line",
        "Press","swap","to step","selectunit","to","selectswap1target","and step","selectswapunit","in the other direction to",["onlyin","swap2step"]
      ]
    }
  },
  "graphics": {
    "icons": {"pinets":"pawn","piokers":"bishop","piases":"king"},
    "tiles": {"base":"playercolour"}
  },
  "board": {
    "height":5,
    "width":5,
    "terrain": {
      "base": {
        "1": [["rect","a1","e1"]],
        "2": [["rect","a5","e5"]]
      }
    }
  },
  "setup": {
    "pinets": {"1":["a1","e1"],"2":["a5","e5"]},
    "piokers": {"1":["b1","d1"],"2":["b5","d5"]},
    "piases": {"1":["c1"],"2":["c5"]}
  },
  "endGame": {
    "infiltration": {"condition":["overlaps","myunits","oppbase"],"show":["intersect","myunits","oppbase"]}
  },
  "startTurn": {
    "link": "selectunit"
  },
  "marks": {
    "selectunit": {
      "from": "myunits",
      "runGenerator": "findmovetargets",
      "links": ["selectmovetarget","selectswapunit"]
    },
    "selectmovetarget": {
      "from": "movetargets",
      "link": ["ifelse",
        ["and",
          ["anyat","units","selectmovetarget"],
          ["noneat","oppbase","selectmovetarget"]
        ],
        "selectdeportdestination",
        "move"
      ]
    },
    "selectdeportdestination": {
      "from": ["subtract","oppbase","oppunits"],
      "link": "move"
    },
    "selectswapunit": {
      "from": ["subtract","myunits",["single","selectunit"]],
      "runGenerator": "findswap1steps",
      "link": "selectswap1target"
    },
    "selectswap1target": {
      "from": "swap1steps",
      "runGenerator": "findswap2step",
      "link": ["if",["notempty","swap2step"],"swap"]
    }
  },
  "commands": {
    "move": {
      "applyEffects": [
        ["if",
          ["anyat","units","selectmovetarget"],
          ["ifelse",
            ["anyat","oppbase","selectmovetarget"],
            ["killat","selectmovetarget"],
            ["moveat","selectmovetarget","selectdeportdestination"]
          ]
        ],
        ["moveat","selectunit","selectmovetarget"]
      ],
      "link": "endturn"
    },
    "swap": {
      "applyEffects": [
        ["moveat","selectunit","selectswap1target"],
        ["moveat","selectswapunit",["onlyin","swap2step"]]
      ],
      "link": "endturn"
    }
  },
  "generators": {
    "findswap2step": {
      "type": "neighbour",
      "start": "selectswapunit",
      "dir": ["reldir",5,["read","swap1steps","selectswap1target","dir"]],
      "unlessover": ["union","units",["single","selectswap1target"]],
      "draw": {
        "neighbours": {
          "tolayer": "swap2step"
        }
      }
    },
    "findswap1steps": {
      "type": "neighbour",
      "start": "selectunit",
      "dirs": [1,3,5,7],
      "unlessover": "units",
      "draw": {
        "neighbours": {
          "tolayer": "swap1steps",
          "include": {"dir": ["dir"]}
        }
      }
    },
    "findmovetargets": {
      "type": "neighbour",
      "start": "selectunit",
      "dirs": ["playercase",
        ["ifelse",
          ["anyat","pinets","selectunit"],
          [1],
          ["ifelse",
            ["anyat","piokers","selectunit"],
            [8,2],
            [8,1,2]
          ]
        ],
        ["ifelse",
          ["anyat","pinets","selectunit"],
          [5],
          ["ifelse",
            ["anyat","piokers","selectunit"],
            [4,6],
            [4,5,6]
          ]
        ]
      ],
      "unlessover": "myunits",
      "draw": {
        "neighbours": {
          "tolayer": "movetargets"
        }
      }
    }
  }
}