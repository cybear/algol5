{
  "meta": {
    "id": "murusgallicus",
    "name": "Murus Gallicus",
    "source": "https://boardgamegeek.com/filepage/46316/murus-gallicus-detailed-rules",
    "tags": ["differentunits","infiltrate"],
    "author": "Phillip L. Leduc",
    "instructions": {
      "startTurn": ["line","Select a","rook","to act with"],
      "selecttower": ["line",
        "Select",["orlist",
          [["notempty","movetargets"],"a move target"],
          [["notempty","killtargets"],["line","an enemy","pawn","to kill"]]
        ],
        "for the","selecttower","rook"
      ],
      "selectmove": ["line","Press","move","to overturn your","selecttower","rook","towards","selectmove"],
      "selectkill": ["line","Press","kill","to make a section of the","selecttower","rook","crush the enemy","pawn","at","selectkill"]
    }
  },
  "graphics": { "tiles": {"homerow":"playercolour"}, "icons": {"towers":"rook","walls":"pawn"} },
  "board": {
    "height": 7, "width": 8,
    "terrain": { "homerow": { "1": [["rect","a1","h1"]], "2":[["rect","a7","h7"]] } }
  },
  "setup": { "towers": { "1": [["rect","a1","h1"]], "2":[["rect","a7","h7"]] } },
  "startTurn": {
    "link": "selecttower"
  },
  "endGame": {
    "infiltration": {"condition":["overlaps","myunits","opphomerow"],"show":["intersect","myunits","opphomerow"]}
  },
  "marks": {
    "selecttower": {
      "from": "mytowers",
      "runGenerators": ["findmovetargets","findkilltargets"],
      "links": [ "selectmove", "selectkill" ]
    },
    "selectmove": {
      "from": "movetargets",
      "runGenerators": ["findmoveresults"],
      "link": "move"
    },
    "selectkill": {
      "from": "killtargets",
      "link": "kill"
    }
  },
  "commands": {
    "move": {
      "applyEffects": [
        ["killat","selecttower"],
        ["forposin","madetowers",["setat",["target"],"group","towers"]],
        ["forposin","madewalls",["spawn",["target"],"walls",["player"],{"from":["pos","selecttower"]}]]
      ],
      "link": "endturn"
    },
    "kill": {
      "applyEffects": [
        ["setat","selecttower","group","walls"],
        ["killat","selectkill"]
      ],
      "link": "endturn"
    }
  },
  "generators": {
    "findmovetargets": {
      "type": "walker",
      "dirs": [1,2,3,4,5,6,7,8],
      "blocks": ["union","oppunits","mytowers"],
      "start": "selecttower",
      "max": 2,
      "draw": {
        "steps": {
          "condition": ["and",
            ["same",["walklength"],2],
            ["same",["step"],2]
          ],
          "tolayer": "movetargets",
          "include": {"dir":["dir"]}
        }
      }
    },
    "findmoveresults": {
      "type": "neighbour",
      "dir": ["reldir",5,["read","movetargets","selectmove","dir"]],
      "start": "selectmove",
      "draw": {
        "start": {
          "tolayer": ["ifelse",["anyat","myunits","selectmove"],"madetowers","madewalls"]
        },
        "neighbours": {
          "tolayer": ["ifelse",["anyat","myunits",["target"]],"madetowers","madewalls"]
        }
      }
    },
    "findkilltargets": {
      "type": "neighbour",
      "start": "selecttower",
      "dirs": [1,2,3,4,5,6,7,8],
      "ifover": "oppwalls",
      "draw": {
        "neighbours": {
          "tolayer": "killtargets"
        }
      }
    }
  },
  "AI": {
    "terrain": {
      "threatrow": {
        "1": [["rect","a3","h3"]],
        "2":[["rect","a5","h5"]]
      }
    },
    "scorings": {
      "basic": [
        [
          [0,0,0,0,0,0,0,0],
          [1,1,1,1,1,1,1,1],
          [2,3,4,4,4,4,3,2],
          [0,0,3,3,3,3,0,0],
          [0,0,2,2,2,2,0,0],
          [0,0,1,1,1,1,0,0],
          [0,0,0,0,0,0,0,0]
        ],
        "mirror"
      ]
    },
    "generators": {
      "findmymoves": {
        "type": "walker",
        "dirs": [1,2,3,4,5,6,7,8],
        "blocks": ["union","towers","oppwalls"],
        "starts": "mytowers",
        "max": 2,
        "draw": {
          "steps": {
            "condition": ["and",
              ["same",["walklength"],2],
              ["same",["step"],2]
            ],
            "tolayer": "mymoves"
          }
        }
      },
      "findoppmoves": {
        "type": "walker",
        "dirs": [1,2,3,4,5,6,7,8],
        "blocks": ["union","towers","mywalls"],
        "starts": "opptowers",
        "max": 2,
        "draw": {
          "steps": {
            "condition": ["and",
              ["same",["walklength"],2],
              ["same",["step"],2]
            ],
            "tolayer": "oppmoves"
          }
        }
      },
      "findoppthreats": {
        "type": "filter",
        "layer": "mythreatrow",
        "condition": ["anyat","oppmoves",["target"]],
        "tolayer": ["ifelse",["anyat","oppwalls",["target"]],"oppheavythreats","opplightthreats"]
      }
    },
    "aspects": {
      "mymoves": ["sizeof","mymoves"],
      "mytowerpos": ["score","mytowers","mybasic"],
      "mywallpos": ["score","mytowers","mybasic"],
      "oppmoves": ["sizeof","oppmoves"],
      "mytowercount": ["sizeof","mytowers"],
      "oppwinmoves": ["sizeof",["union","oppmoves","myhomerow"]],
      "opplightthreats": ["sizeof","opplightthreats"],
      "oppheavythreats": ["sizeof","oppheavythreats"]
    },
    "brains": {
      "Steve": {
        "generators": ["findoppmoves","findoppthreats"],
        "plus": {
          "mytowercount": 2,
          "mywallpos": 1,
          "mytowerpos": 2
        },
        "minus": {
          "oppwinmoves": 10000,
          "opplightthreats": 20,
          "oppheavythreats": 500
        }
      },
      "Joe": {
        "generators": ["findoppmoves"],
        "plus": {
          "mytowercount": 2,
          "mywallpos": 1,
          "mytowerpos": 2
        },
        "minus": {
          "oppwinmoves": 100
        }
      },
      "Clive": {
        "generators": ["findmymoves","findoppmoves"],
        "plus": {
          "mymoves": 1,
          "mytowerpos": 3,
          "mywallpos": 1
        },
        "minus": {
          "oppmoves": 1
        }
      }
    }
  }
}



