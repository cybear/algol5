{
  "meta": {
    "name": "Ugly duck",
    "id": "uglyduck",
    "source": "http://www.di.fc.ul.pt/~jpn/gv/uglyduck.htm",
    "tags": ["capture","differentunits"],
    "instructions": {
      "startTurn": ["line","Select",["orlist",
        [["notempty","mysoldiers"],"a pawn to advance"],
        [["notempty","mykings"],"a king to retreat"]
      ]],
      "selectunit": ["ifelse",
        ["anyat","mykings","selectunit"],
        "Select a square closer to home to move your king to",
        "Select a square closer to the enemy lines to move your pawn to"
      ],
      "selectmovetarget": ["line",
        "Press","move","to",["ifelse",
          ["anyat","mykings","selectunit"],
          "retreat your king",
          "advance your pawn"
        ],
        "from","selectunit",
        ["ifelse",
          ["anyat","opphomerow","selectmovetarget"],
          ["line","into the opponent base at","selectmovetarget"],
          ["ifelse",
            ["anyat","myhomerow","selectmovetarget"],
            ["line","back home to","selectmovetarget"],
            ["line","to","selectmovetarget"]
          ]
        ],
        ["if",["anyat","oppunits","selectmovetarget"],["line",", killing the enemy",["ifelse",
          ["anyat","kings","selectmovetarget"],"king","pawn"]
        ]]
      ]
    }
  },
  "graphics": {"icons": {"soldiers":"pawn","kings":"king"},"tiles":{"homerow":"playercolour"}},
  "board": {
    "height":5,
    "width":5,
    "terrain": {
      "homerow": {"1":[["rect","a1","e1"]],"2":[["rect","a5","e5"]]}
    }
  },
  "setup": {
    "soldiers": {
      "1": [["rect","a1","e1"]],
      "2": [["rect","a5","e5"]]
    }
  },
  "startTurn": {
    "link": "selectunit"
  },
  "endGame": {
    "swanhome": {"condition":["overlaps","mykings","myhomerow"],"show":["intersect","mykings","myhomerow"]}
  },
  "marks": {
    "selectunit": {
      "from": "myunits",
      "runGenerator": "findmovetargets",
      "link": "selectmovetarget"
    },
    "selectmovetarget": {
      "from": "movetargets",
      "link": "move"
    }
  },
  "commands": {
    "move": {
      "applyEffects": [
        ["if",["anyat","opphomerow","selectmovetarget"],["setat","selectunit","group","kings"]],
        ["stompat","selectunit","selectmovetarget"]
      ],
      "link": "endturn"
    }
  },
  "generators": {
    "findmovetargets": {
      "type": "neighbour",
      "start": "selectunit",
      "dirs": ["playercase",
        ["ifelse",["anyat","mykings","selectunit"],["list",[4,5,6]],["list",[8,1,2]]],
        ["ifelse",["anyat","mykings","selectunit"],["list",[8,1,2]],["list",[4,5,6]]]
      ],
      "condition": ["ifelse",
        ["or",["same",["dir"],1],["same",["dir"],5]],
        ["noneat","units",["target"]],
        ["noneat","myunits",["target"]]
      ],
      "draw": {
        "neighbours": {
          "tolayer": "movetargets"
        }
      }
    }
  }
}